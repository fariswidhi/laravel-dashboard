
    $.ajaxSetup({
    headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    }
});




$(document).on('click','.create-btn',function(){
      var src = $(this).attr('data-src');
      var title = $(this).attr('data-title');
      var actionBtn = $(this).attr('data-save');

      var large = $(this).attr('data-large');
      var iframe = $(this).attr('data-iframe');

  
      if (large!=null) {
        $("#modal .modal-dialog").addClass('modal-lg');
      }
      else{
        $("#modal .modal-dialog").removeClass('modal-lg');

      }

      $.get(src,function(res){

        $("#modal .modal-title").text(title);
        $("#modal  .modal-body").html(res);
        if (actionBtn!=null) {
          $(".save-btn").hide();
        }
        else{
          $(".save-btn").show();

        }

        // $(".select2").select2();
        var url;
        

     



      });
      var large = $(this).attr('data-large');
      // console.log(large);
      if (large!=null) {
        $("#modal .modal-dialog").addClass('modal-super-lg');
      }
      else{
        var lg =  $(this).attr('data-lg');
        console.log(lg);
        if (lg!=null) {
        $("#modal .modal-dialog").removeClass('modal-super-lg');

        $("#modal .modal-dialog").addClass('modal-lg');

        }
        else{
        $("#modal .modal-dialog").removeClass('modal-super-lg');
        $("#modal .modal-dialog").removeClass('modal-lg');

        }
        
      }

    $('#modal').modal({backdrop: 'static', keyboard: false})  

      $("#modal").modal("show");
    });



    $(document).on('click','.save-btn',function(){
      var entype = ($("#form").attr('enctype') == null ? 0 :1);
      var redirect = ($(this).attr('data-redirect') == null ? 0 :1);

      // console.log(en);
      // return;
      

        $(".loading").show();
        $(this).attr('disabled','disabled');



        // $("#loaderModal").modal("show");
        // return ;
      if (entype==1) {
// return;
  var formData = new FormData($("#form")[0]);

// console.log(formData);
  $.ajax({

            type:'POST',
            url: $("#form").attr('action'),
            data:formData,
            cache:false,
            method: "POST",
            contentType: false,
            processData: false,
            dataType: "JSON",
            success:function(res){
//              console.log(res);
        $(".save-btn").removeAttr('disabled');

            if (res.success) {



           
$.notify({
  // options
  message: res.msg
},{
  // settings
  z_index:100000,
  type: 'success'
});



              $("#modal").modal('hide');

              // setTimeout(function(){
              //   location.reload();
              // },1000);

              $('#table').DataTable().ajax.reload();


             }


            else{

           
$.notify({
  // options
  message: res.msg
},{
  // settings
  z_index:100000,
  type: 'danger'
});



            }

        $(".loading").hide();



            }

  })
.fail(function(data, textStatus, xhr) {
  // console.log("erroxr");

  // console.log(data);
  if (data.status==422) {
        $(".save-btn").removeAttr('disabled');

      $('input').removeClass('is-invalid');
      $('select').removeClass('is-invalid');
      $(".invalid-feedback").remove();

    // console.log(data.responseJSON);
    $.each(data.responseJSON.errors, function(index,val) {
      // console.log(index);
      // console.log(val);
      $('[name='+index+']').after("");

      $('[name='+index+']').addClass('is-invalid');
      var msg = '<div class="invalid-feedback">'+val+'</div>';
      $('[name='+index+']').after(msg);
       /* iterate through array or object */
    });
  }
});




      }
      else{
        var formData = $("#form").serialize();
          $.ajax({

            type:'POST',
            url: $("#form").attr('action'),
            data:formData,
            method: "POST",
            dataType: "JSON",
            success:function(res){
//              console.log(res);
        $(".save-btn").removeAttr('disabled');

            if (res.success) {

           
$.notify({
  // options
  message: res.msg
},{
  // settings
  z_index:100000,
  type: 'success'
});
             // if (redirect==1) {
             //  location.href = "https://ceritarembang.com";
              
             // }
             // else{

              $("#modal").modal('hide');
              $('#table').DataTable().ajax.reload();

             // }
            }
            else{


           
$.notify({
  // options
  message: res.msg
},{
  z_index:100000,
  // settings
  type: 'danger'
});

            }
                    $(".loading").hide();

            }

  })
.fail(function(data, textStatus, xhr) {
  // console.log("erroxr");

  // console.log(data);
  if (data.status==422) {
        $(".save-btn").removeAttr('disabled');

      $('input').removeClass('is-invalid');
      $('select').removeClass('is-invalid');
      $(".invalid-feedback").remove();

    // console.log(data.responseJSON);
    $.each(data.responseJSON.errors, function(index,val) {
      // console.log(index);
      // console.log(val);
      $('[name='+index+']').after("");

      $('[name='+index+']').addClass('is-invalid');
      var msg = '<div class="invalid-feedback">'+val+'</div>';
      $('[name='+index+']').after(msg);
       /* iterate through array or object */
    });
  }
});


      }
      
    });



    $(document).on('click', '.delete-btn', function(event) {
      event.preventDefault();
      var reload = ($(this).attr('data-reload')!=null ? true:false);
      /* Act on the event */

      Swal.fire({
  title: 'Yakin Akan Menghapus Data?',
  text: "Data Akan Hilang Selamanya dan Tidak Bisa dipulihkan",
  type: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'Ya',
    cancelButtonText: 'Tidak',
    focusCancel: true,

}).then((result) => {
  if (result.value) {


      var src = $(this).attr('href');
        var formData = $("#form").serialize();
          $.ajax({

            type:'DELETE',
            url: src,
            method: "DELETE",
            data: {
                 _token: $('meta[name="csrf-token"]').attr('content'),
            },
            dataType: "JSON",
            success:function(res){
//              console.log(res);
            // if (res.status=="1") {
            //   $("#modal").modal('hide');
            if (res.success) {

$.notify({
  // options
  message: res.msg
},{
  // settings
  z_index:100000,
  type: 'success'
});

              $('#table').DataTable().ajax.reload();
              if(reload){
                location.reload();
              }
            // }
            }
            else{
              $.notify({
  // options
  message: res.msg
},{
  // settings
  z_index:100000,
  type: 'danger'
});
            }
            }

  });



  }
})
});